<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π - –ù–∞—à –¥–µ–∫–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
            text-align: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 1rem;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #007bff;
            color: white;
        }

        .tab:hover {
            background: #0056b3;
            color: white;
        }

        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .result {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 1rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .product-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .product-item {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-info h3 {
            margin-bottom: 0.5rem;
            color: #495057;
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .product-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .product-actions {
                margin-top: 1rem;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º –æ–±–æ–µ–≤ "–ù–∞—à –¥–µ–∫–æ—Ä"</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('create')">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ü–∏—é</button>
            <button class="tab" onclick="switchTab('edit')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ü–∏—é</button>
            <button class="tab" onclick="switchTab('list')">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</button>
            <button class="tab" onclick="switchTab('test')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</button>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ü–∏–∏ -->
        <div id="create-section" class="form-section active">
            <div class="form-container">
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h2>
                <form id="create-form">
                    <div class="form-group">
                        <label class="form-label">–ê—Ä—Ç–∏–∫—É–ª *</label>
                        <input type="text" name="article" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏ *</label>
                        <select name="product_type_id" class="form-control" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ *</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name="description" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (‚ÇΩ) *</label>
                            <input type="number" name="min_partner_price" class="form-control" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–®–∏—Ä–∏–Ω–∞ —Ä—É–ª–æ–Ω–∞ (–º)</label>
                            <input type="number" name="roll_width" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–î–ª–∏–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_length" class="form-control" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–®–∏—Ä–∏–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_width" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–í—ã—Å–æ—Ç–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_height" class="form-control" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                            <input type="number" name="cost_price" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–í—Ä–µ–º—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (—á–∞—Å—ã)</label>
                            <input type="number" name="production_time_hours" class="form-control" step="0.1" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–æ–º–µ—Ä —Ü–µ—Ö–∞</label>
                            <input type="text" name="workshop_number" class="form-control">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ü–∏—é</button>
                    <button type="reset" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                </form>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ü–∏–∏ -->
        <div id="edit-section" class="form-section">
            <div class="form-container">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h2>
                
                <div class="form-group">
                    <label class="form-label">ID –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="number" id="edit-product-id" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–æ–¥—É–∫—Ü–∏–∏">
                        <button onclick="loadProductForEdit()" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                </div>

                <form id="edit-form" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">–ê—Ä—Ç–∏–∫—É–ª *</label>
                        <input type="text" name="article" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏ *</label>
                        <select name="product_type_id" class="form-control" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ *</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name="description" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (‚ÇΩ) *</label>
                            <input type="number" name="min_partner_price" class="form-control" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–®–∏—Ä–∏–Ω–∞ —Ä—É–ª–æ–Ω–∞ (–º)</label>
                            <input type="number" name="roll_width" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–î–ª–∏–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_length" class="form-control" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–®–∏—Ä–∏–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_width" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–í—ã—Å–æ—Ç–∞ —É–ø–∞–∫–æ–≤–∫–∏ (—Å–º)</label>
                            <input type="number" name="package_height" class="form-control" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                            <input type="number" name="cost_price" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–í—Ä–µ–º—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (—á–∞—Å—ã)</label>
                            <input type="number" name="production_time_hours" class="form-control" step="0.1" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–æ–º–µ—Ä —Ü–µ—Ö–∞</label>
                            <input type="text" name="workshop_number" class="form-control">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-warning">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ü–∏—é</button>
                    <button type="button" onclick="cancelEdit()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ -->
        <div id="list-section" class="form-section">
            <div class="form-container">
                <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h2>
                <button onclick="loadProducts()" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <div id="products-list" class="product-list" style="margin-top: 1rem;">
                    <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API -->
        <div id="test-section" class="form-section">
            <div class="form-container">
                <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                    <button onclick="testGetProducts()" class="btn btn-primary">GET /api/v1/products</button>
                    <button onclick="testGetProductTypes()" class="btn btn-secondary">GET /api/v1/product-types</button>
                    <button onclick="testCreateProduct()" class="btn btn-success">POST /api/v1/products</button>
                    <button onclick="testUpdateProduct()" class="btn btn-warning">PUT /api/v1/products/1</button>
                    <button onclick="testDeleteProduct()" class="btn btn-danger">DELETE /api/v1/products/1</button>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="result" class="result" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
            <div id="result-content"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let currentEditId = null;

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å —Ç–∞–±–æ–≤
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(tabName + '-section').classList.add('active');
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'create' || tabName === 'edit') {
                loadProductTypes();
            } else if (tabName === 'list') {
                loadProducts();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
        async function loadProductTypes() {
            try {
                const response = await fetch(`${API_BASE}/product-types`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const productTypes = data.data || [];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∞ —Å–µ–ª–µ–∫—Ç–∞
                const selects = document.querySelectorAll('select[name="product_type_id"]');
                selects.forEach(select => {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏</option>';
                    productTypes.forEach(type => {
                        select.innerHTML += `<option value="${type.id}">${type.name}</option>`;
                    });
                });
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ü–∏–∏: ' + error.message, 'error');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è
            ['product_type_id', 'min_partner_price', 'roll_width', 'package_length', 
             'package_width', 'package_height', 'cost_price', 'production_time_hours'].forEach(field => {
                if (data[field] && data[field] !== '') {
                    data[field] = parseFloat(data[field]);
                } else if (field !== 'product_type_id' && field !== 'min_partner_price') {
                    delete data[field]; // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                }
            });
            
            try {
                const response = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showResult('–ü—Ä–æ–¥—É–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! ID: ' + result.data.id, 'success');
                    e.target.reset();
                } else {
                    showResult('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function loadProductForEdit() {
            const id = document.getElementById('edit-product-id').value;
            if (!id) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–æ–¥—É–∫—Ü–∏–∏');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/products/${id}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success && result.data) {
                    fillEditForm(result.data);
                    currentEditId = id;
                    document.getElementById('edit-form').style.display = 'block';
                    showResult('–ü—Ä–æ–¥—É–∫—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'success');
                } else {
                    showResult('–ü—Ä–æ–¥—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                }
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
            }
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function fillEditForm(product) {
            const form = document.getElementById('edit-form');
            
            form.querySelector('[name="article"]').value = product.article || '';
            form.querySelector('[name="product_type_id"]').value = product.product_type_id || '';
            form.querySelector('[name="name"]').value = product.name || '';
            form.querySelector('[name="description"]').value = product.description || '';
            form.querySelector('[name="min_partner_price"]').value = product.min_partner_price || '';
            form.querySelector('[name="roll_width"]').value = product.roll_width || '';
            form.querySelector('[name="package_length"]').value = product.package_length || '';
            form.querySelector('[name="package_width"]').value = product.package_width || '';
            form.querySelector('[name="package_height"]').value = product.package_height || '';
            form.querySelector('[name="cost_price"]').value = product.cost_price || '';
            form.querySelector('[name="production_time_hours"]').value = product.production_time_hours || '';
            form.querySelector('[name="workshop_number"]').value = product.workshop_number || '';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
        document.getElementById('edit-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentEditId) {
                alert('–ù–µ—Ç ID –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
                return;
            }
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è
            ['product_type_id', 'min_partner_price', 'roll_width', 'package_length', 
             'package_width', 'package_height', 'cost_price', 'production_time_hours'].forEach(field => {
                if (data[field] && data[field] !== '') {
                    data[field] = parseFloat(data[field]);
                } else if (field !== 'product_type_id' && field !== 'min_partner_price') {
                    delete data[field];
                }
            });
            
            try {
                const response = await fetch(`${API_BASE}/products/${currentEditId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showResult('–ü—Ä–æ–¥—É–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                } else {
                    showResult('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        });

        // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function cancelEdit() {
            document.getElementById('edit-form').style.display = 'none';
            document.getElementById('edit-product-id').value = '';
            currentEditId = null;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                const products = result.data || [];
                
                const listContainer = document.getElementById('products-list');
                if (products.length === 0) {
                    listContainer.innerHTML = '<div class="alert alert-info">–ü—Ä–æ–¥—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
                    return;
                }
                
                listContainer.innerHTML = products.map(product => `
                    <div class="product-item">
                        <div class="product-info">
                            <h3>${product.name} (${product.article})</h3>
                            <p><strong>–¢–∏–ø:</strong> ${product.type_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p><strong>–¶–µ–Ω–∞:</strong> ${product.min_partner_price}‚ÇΩ</p>
                            ${product.roll_width ? `<p><strong>–®–∏—Ä–∏–Ω–∞:</strong> ${product.roll_width}–º</p>` : ''}
                        </div>
                        <div class="product-actions">
                            <button onclick="editProduct(${product.id})" class="btn btn-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button onclick="deleteProduct(${product.id})" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞: ' + error.message, 'error');
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
        function editProduct(id) {
            switchTab('edit');
            document.getElementById('edit-product-id').value = id;
            loadProductForEdit();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
        async function deleteProduct(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–¥—É–∫—Ü–∏—é?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/products/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showResult('–ü—Ä–æ–¥—É–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    loadProducts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showResult('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showResult('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ API
        async function testGetProducts() {
            await testApiCall('GET', '/products', null, '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏');
        }

        async function testGetProductTypes() {
            await testApiCall('GET', '/product-types', null, '–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ü–∏–∏');
        }

        async function testCreateProduct() {
            const testProduct = {
                article: 'TEST-' + Date.now(),
                product_type_id: 1,
                name: '–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è',
                description: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏',
                min_partner_price: 100.00
            };
            await testApiCall('POST', '/products', testProduct, '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏');
        }

        async function testUpdateProduct() {
            const testUpdate = {
                name: '–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è',
                min_partner_price: 150.00
            };
            await testApiCall('PUT', '/products/1', testUpdate, '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ —Å ID 1');
        }

        async function testDeleteProduct() {
            if (confirm('–≠—Ç–æ —É–¥–∞–ª–∏—Ç –ø—Ä–æ–¥—É–∫—Ü–∏—é —Å ID 1. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                await testApiCall('DELETE', '/products/1', null, '–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ —Å ID 1');
            }
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
        async function testApiCall(method, endpoint, data, description) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                showResult(
                    `<strong>${description}</strong><br>
                     <strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}<br>
                     <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong><br>
                     <pre>${JSON.stringify(result, null, 2)}</pre>`,
                    response.ok ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`<strong>${description}</strong><br>–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            const contentDiv = document.getElementById('result-content');
            
            contentDiv.innerHTML = `<div class="alert alert-${type === 'success' ? 'success' : 'error'}">${message}</div>`;
            resultDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
            if (type === 'success') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 10000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadProductTypes();
        });
    </script>
</body>
</html> 