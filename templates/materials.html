{{define "content"}}
<div class="page-header">
    <h2>Список материалов</h2>
    <a href="/" class="btn btn-secondary">← Назад к продукции</a>
</div>

{{if .materials}}
<div class="materials-table-container">
    <table class="materials-table">
        <thead>
            <tr>
                <th>Наименование</th>
                <th>Артикул</th>
                <th>Тип материала</th>
                <th>Стоимость за единицу (₽)</th>
                <th>Остаток на складе</th>
                <th>Мин. остаток</th>
                <th>Единица измерения</th>
                <th>Процент брака (%)</th>
            </tr>
        </thead>
        <tbody>
            {{range .materials}}
            <tr>
                <td class="material-name">
                    <strong>{{.Name}}</strong>
                    {{if .Description}}
                        <br><small style="color: #6c757d;">{{.Description}}</small>
                    {{end}}
                </td>
                <td class="material-article">{{.Article}}</td>
                <td class="material-type">{{.MaterialType.Name}}</td>
                <td class="material-cost">{{printf "%.2f" .CostPerUnit}}</td>
                <td class="material-stock 
                    {{if lt .StockQuantity .MinStockQuantity}}low-stock{{end}}">
                    {{printf "%.3f" .StockQuantity}}
                </td>
                <td class="material-min-stock">{{printf "%.3f" .MinStockQuantity}}</td>
                <td class="material-unit">{{.MeasurementUnit.Abbreviation}}</td>
                <td class="material-waste">{{printf "%.1f" .MaterialType.WastePercentage}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<div class="materials-summary">
    <div class="summary-card">
        <h4>Итого материалов: {{len .materials}}</h4>
        <p>
            {{$lowStock := 0}}
            {{range .materials}}
                {{if lt .StockQuantity .MinStockQuantity}}
                    {{$lowStock = add $lowStock 1}}
                {{end}}
            {{end}}
            {{if gt $lowStock 0}}
                <span class="low-stock-warning">⚠️ Материалов с низким остатком: {{$lowStock}}</span>
            {{else}}
                <span class="stock-ok">✅ Все материалы в наличии</span>
            {{end}}
        </p>
    </div>
</div>

{{else}}
<div class="empty-state">
    <p>Материалы не найдены</p>
</div>
{{end}}

<style>
.low-stock {
    background-color: #fff3cd !important;
    color: #856404;
    font-weight: bold;
}

.low-stock-warning {
    color: #dc3545;
    font-weight: bold;
}

.stock-ok {
    color: #28a745;
    font-weight: bold;
}

.materials-summary {
    margin-top: 2rem;
}

.summary-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.summary-card h4 {
    margin-bottom: 1rem;
    color: #2c3e50;
}
</style>
{{end}} 